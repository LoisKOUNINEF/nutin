{
	"id": 3,
	"sectionId": 4,
	"content": "# ---------------------------\n# HEADER VARIABLES (define outside server block)\n# ---------------------------\nmap $uri $frame_options {\n\t\tdefault \"SAMEORIGIN\";\n}\n\nmap $uri $content_type_options {\n\t\tdefault \"nosniff\";\n}\n\nmap $uri $xss_protection {\n\t\tdefault \"1; mode=block\";\n}\n\nmap $uri $referrer_policy {\n\t\tdefault \"strict-origin-when-cross-origin\";\n}\n\nmap $uri $permissions_policy {\n\t\tdefault \"geolocation=(), microphone=(), camera=()\";\n}\n\nmap $uri $csp_policy {\n    default \"default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none';\";\n}\n\nserver {\n\t\t# ---------------------------\n\t\t# LISTEN PORTS\n\t\t# ---------------------------\n\t\tlisten 9090;\n\t\tlisten 9091;\n\t\tserver_name _;\n\n\t\t# ---------------------------\n\t\t# ROOT + ROUTING\n\t\t# ---------------------------\n\t\troot /usr/share/nginx/html;\n\t\tindex index.html;\n\n\t\t# Hide nginx version\n\t\tserver_tokens off;\n\n\t\t# SPA routing: serve index.html for unknown paths\n\t\tlocation / {\n\t\t\t\ttry_files $uri $uri/ /index.html;\n\t\t\t\t\n\t\t\t\t# Security headers\n\t\t\t\tadd_header X-Frame-Options $frame_options always;\n\t\t\t\tadd_header X-Content-Type-Options $content_type_options always;\n\t\t\t\tadd_header X-XSS-Protection $xss_protection always;\n\t\t\t\tadd_header Referrer-Policy $referrer_policy always;\n\t\t\t\tadd_header Permissions-Policy $permissions_policy always;\n\t\t\t\tadd_header Content-Security-Policy $csp_policy always;\n\t\t}\n\n\t\t# ---------------------------\n\t\t# STATIC ASSETS CACHING\n\t\t# ---------------------------\n\n\t\t# Immutable cache for static assets\n\t\tlocation ~* \\.(js|css|png|jpg|jpeg|gif|avif|ico|svg|woff|woff2|ttf|eot)$ {\n\t\t\t\texpires 1y;\n\t\t\t\tadd_header Cache-Control \"public, immutable\" always;\n\t\t\t\t\n\t\t\t\t# Security headers\n\t\t\t\tadd_header X-Frame-Options $frame_options always;\n\t\t\t\tadd_header X-Content-Type-Options $content_type_options always;\n\t\t\t\tadd_header X-XSS-Protection $xss_protection always;\n\t\t\t\tadd_header Referrer-Policy $referrer_policy always;\n\t\t\t\tadd_header Permissions-Policy $permissions_policy always;\n\t\t\t\tadd_header Content-Security-Policy $csp_policy always;\n\t\t}\n\n\t\t# No caching for HTML files (SPA shell)\n\t\tlocation ~* \\.html$ {\n\t\t\t\texpires -1;\n\t\t\t\tadd_header Cache-Control \"no-cache, no-store, must-revalidate\" always;\n\t\t\t\tadd_header Pragma \"no-cache\" always;\n\t\t\t\t\n\t\t\t\t# Security headers\n\t\t\t\tadd_header X-Frame-Options $frame_options always;\n\t\t\t\tadd_header X-Content-Type-Options $content_type_options always;\n\t\t\t\tadd_header X-XSS-Protection $xss_protection always;\n\t\t\t\tadd_header Referrer-Policy $referrer_policy always;\n\t\t\t\tadd_header Permissions-Policy $permissions_policy always;\n\t\t\t\tadd_header Content-Security-Policy $csp_policy always;\n\t\t}\n\n\t\t# ---------------------------\n\t\t# HEALTH ENDPOINT\n\t\t# ---------------------------\n\t\tlocation /health {\n\t\t\t\taccess_log off;\n\t\t\t\tadd_header Content-Type text/plain always;\n\t\t\t\treturn 200 \"healthy\\n\";\n\t\t}\n}\n",
	"type": "none",
	"en": {
		"title": "Nginx config",
		"before": "A minimal Nginx setup including :\n\t• SPA routing (try_files)\n\t• Strong security headers\n\t• Modern Content Security Policy (and legacy security headers)\n\t• Immutable static asset caching\n\t• index.html no-cache strategy\n\t• Health endpoint (/health)\nThis config uses nginx map directives to define headers once, then reuse them.",
		"after": "When you use add_header in a child location block, it replaces ALL headers from the parent context rather than merging them.\nYou need to repeat the security headers in each location block that uses add_header."
	},
	"fr": {
		"title": "Configuration Nginx",
		"before": "Un setup Nginx minimal incluant :\n\t• Un routing SPA (try_files)\n\t• Des headers de sécurité robustes\n\t• Une Content Security Policy moderne (et des headers de sécurité pour les navigateurs anciens)\n\t• Cache des ressources statiques immuables\n\t• Health endpoint (/health)\nCette configuration utilise la directive nginx map pour définir les headers une seul fois, puis les réutiliser.",
		"after": "Quand vous utilisez add_header dans le block de location d'un enfant, cela remplace TOUS les headers du contexte parent et ne les combine pas.\nVous devez répéter les headers de sécurité dans chaque bloc qui utilise add_header."
	}
}
